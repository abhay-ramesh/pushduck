{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "upload-paste",
  "type": "registry:component",
  "title": "Upload Paste",
  "description": "Paste-to-upload component with image preview support. Supports both immediate upload (chat interfaces) and preview mode (controlled uploads).",
  "dependencies": [
    "pushduck",
    "lucide-react"
  ],
  "registryDependencies": [
    "button",
    "progress"
  ],
  "files": [
    {
      "path": "registry/default/upload-paste/upload-paste.tsx",
      "content": "\"use client\";\n\nimport { cn } from \"@/lib/utils\";\nimport { AlertCircle, Image as ImageIcon, Upload, X } from \"lucide-react\";\nimport { usePasteUpload } from \"pushduck/client\";\nimport * as React from \"react\";\n\nexport interface UploadPasteProps {\n  /** Upload route name from your API */\n  route: string;\n  /** Accepted file types (MIME types or extensions) */\n  accept?: string;\n  /** Maximum file size in bytes */\n  maxSize?: number;\n  /** Maximum number of files */\n  maxFiles?: number;\n  /** Upload mode - 'immediate' (upload immediately on paste) or 'preview' (show preview, manual upload) */\n  mode?: \"immediate\" | \"preview\";\n  /** Boolean alias for mode (true = 'immediate', false = 'preview') */\n  autoUpload?: boolean;\n  /** Paste detection scope - 'document' (anywhere on page) or 'container' (within this component) */\n  scope?: \"document\" | \"container\";\n  /** Allow paste detection when user is in input/textarea (default: true) */\n  allowInputPaste?: boolean;\n  /** Show previews (only relevant in preview mode, default: true) */\n  showPreviews?: boolean;\n  /** Number of columns in preview grid */\n  previewGridCols?: number;\n  /** Callback when files are pasted */\n  onPaste?: (files: File[]) => void;\n  /** Callback when upload completes */\n  onUploadComplete?: (results: any[]) => void;\n  /** Callback when upload fails */\n  onUploadError?: (error: Error) => void;\n  /** Callback when upload starts (only in immediate mode) */\n  onUploadStart?: () => void;\n  /** Custom validation function */\n  validator?: (files: File[]) => string | null;\n  /** Custom className */\n  className?: string;\n  /** Disabled state */\n  disabled?: boolean;\n  /** Custom content when no previews */\n  children?: React.ReactNode;\n}\n\nexport function UploadPaste({\n  route,\n  accept = \"image/*\",\n  maxSize = 10 * 1024 * 1024, // 10MB default\n  maxFiles = 10,\n  mode: modeProp,\n  autoUpload,\n  scope = \"container\",\n  allowInputPaste = true,\n  showPreviews = true,\n  previewGridCols = 3,\n  onPaste,\n  onUploadComplete,\n  onUploadError,\n  onUploadStart,\n  validator,\n  className,\n  disabled = false,\n  children,\n  ...props\n}: UploadPasteProps) {\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const [errors, setErrors] = React.useState<string[]>([]);\n\n  const {\n    previewFiles,\n    uploadPastedFiles,\n    clearPreviews,\n    files,\n    isUploading,\n    progress,\n    errors: uploadErrors,\n  } = usePasteUpload(route, {\n    route,\n    accept,\n    maxSize,\n    maxFiles,\n    mode: modeProp,\n    autoUpload,\n    scope,\n    containerRef: scope === \"container\" ? containerRef : undefined,\n    allowInputPaste,\n    validator,\n    onPaste: (files) => {\n      setErrors([]);\n      onPaste?.(files);\n    },\n    onUploadComplete: (results) => {\n      setErrors([]);\n      onUploadComplete?.(results);\n    },\n    onUploadError: (error) => {\n      setErrors([error.message]);\n      onUploadError?.(error);\n    },\n    onUploadStart,\n    enabled: !disabled,\n  });\n\n  // Combine errors\n  const allErrors = React.useMemo(\n    () => [...errors, ...uploadErrors],\n    [errors, uploadErrors]\n  );\n\n  // Remove preview\n  const handleRemovePreview = React.useCallback(\n    (id: string) => {\n      setPreviewFiles((prev) => {\n        const file = prev.find((f) => f.id === id);\n        if (file) {\n          URL.revokeObjectURL(file.preview);\n        }\n        return prev.filter((f) => f.id !== id);\n      });\n    },\n    []\n  );\n\n  // Determine if we should show previews\n  const shouldShowPreviews =\n    modeProp === \"preview\" ||\n    (autoUpload === false) ||\n    (modeProp === undefined && autoUpload === undefined);\n\n  const displayPreviews = shouldShowPreviews && showPreviews;\n\n  return (\n    <div className={cn(\"space-y-4\", className)} {...props}>\n      <div\n        ref={containerRef}\n        className={cn(\n          \"relative rounded-lg border-2 border-dashed p-8 transition-all\",\n          scope === \"document\"\n            ? \"border-transparent p-0\"\n            : \"border-muted-foreground/25 hover:border-muted-foreground/50\",\n          disabled && \"cursor-not-allowed opacity-50\",\n          isUploading && \"cursor-wait\"\n        )}\n      >\n        {displayPreviews && previewFiles.length > 0 && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-lg font-medium\">Pasted Images</h3>\n              <div className=\"flex gap-2\">\n                <button\n                  onClick={uploadPastedFiles}\n                  disabled={disabled || isUploading}\n                  className={cn(\n                    \"inline-flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium transition-colors\",\n                    \"bg-primary text-primary-foreground hover:bg-primary/90\",\n                    \"disabled:opacity-50 disabled:cursor-not-allowed\"\n                  )}\n                >\n                  <Upload className=\"h-4 w-4\" />\n                  Upload {previewFiles.length} file\n                  {previewFiles.length !== 1 ? \"s\" : \"\"}\n                </button>\n                <button\n                  onClick={clearPreviews}\n                  disabled={disabled || isUploading}\n                  className={cn(\n                    \"inline-flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium transition-colors\",\n                    \"bg-muted text-muted-foreground hover:bg-muted/80\",\n                    \"disabled:opacity-50 disabled:cursor-not-allowed\"\n                  )}\n                >\n                  Clear\n                </button>\n              </div>\n            </div>\n\n            <div\n              className={cn(\n                \"grid gap-4\",\n                previewGridCols === 1 && \"grid-cols-1\",\n                previewGridCols === 2 && \"grid-cols-1 md:grid-cols-2\",\n                previewGridCols === 3 && \"grid-cols-1 md:grid-cols-2 lg:grid-cols-3\",\n                previewGridCols === 4 && \"grid-cols-1 md:grid-cols-2 lg:grid-cols-4\",\n                previewGridCols === 5 && \"grid-cols-1 md:grid-cols-3 lg:grid-cols-5\",\n                previewGridCols === 6 && \"grid-cols-2 md:grid-cols-3 lg:grid-cols-6\"\n              )}\n            >\n              {previewFiles.map((preview) => (\n                <div\n                  key={preview.id}\n                  className=\"group relative aspect-square overflow-hidden rounded-lg border border-border bg-muted\"\n                >\n                  {preview.type.startsWith(\"image/\") ? (\n                    <img\n                      src={preview.preview}\n                      alt={preview.name}\n                      className=\"h-full w-full object-cover\"\n                    />\n                  ) : (\n                    <div className=\"flex h-full w-full items-center justify-center\">\n                      <ImageIcon className=\"h-8 w-8 text-muted-foreground\" />\n                    </div>\n                  )}\n                  <div className=\"absolute inset-0 bg-black/0 transition-colors group-hover:bg-black/20\" />\n                  <button\n                    onClick={() => handleRemovePreview(preview.id)}\n                    disabled={disabled || isUploading}\n                    className={cn(\n                      \"absolute right-2 top-2 rounded-full bg-black/50 p-1.5 text-white opacity-0 transition-opacity hover:bg-black/70 group-hover:opacity-100\",\n                      \"disabled:opacity-50 disabled:cursor-not-allowed\"\n                    )}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </button>\n                  <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2\">\n                    <p className=\"truncate text-xs font-medium text-white\">\n                      {preview.name}\n                    </p>\n                    <p className=\"text-xs text-white/80\">\n                      {formatFileSize(preview.size)}\n                    </p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {!displayPreviews && previewFiles.length === 0 && (\n          <div className=\"flex flex-col items-center justify-center space-y-4 text-center\">\n            {children || (\n              <>\n                <div className=\"rounded-full bg-muted p-4\">\n                  <ImageIcon className=\"h-8 w-8 text-muted-foreground\" />\n                </div>\n                <div className=\"space-y-2\">\n                  <h3 className=\"text-lg font-medium\">Paste to upload</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {scope === \"document\"\n                      ? \"Paste images anywhere on the page\"\n                      : \"Paste images in this area\"}\n                  </p>\n                  {accept && (\n                    <p className=\"text-xs text-muted-foreground\">\n                      Accepted: {accept}\n                    </p>\n                  )}\n                  <p className=\"text-xs text-muted-foreground\">\n                    Max size: {formatFileSize(maxSize)}\n                  </p>\n                </div>\n              </>\n            )}\n          </div>\n        )}\n\n        {/* Upload progress */}\n        {isUploading && (\n          <div className=\"mt-4 space-y-2\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <span>Uploading...</span>\n              <span>{Math.round(progress)}%</span>\n            </div>\n            <div className=\"h-2 w-full overflow-hidden rounded-full bg-muted\">\n              <div\n                className=\"h-full bg-primary transition-all duration-300\"\n                style={{ width: `${progress}%` }}\n              />\n            </div>\n          </div>\n        )}\n\n        {/* Uploaded files display */}\n        {files.length > 0 && files.some((f) => f.status === \"success\") && (\n          <div className=\"mt-4 space-y-2\">\n            <h4 className=\"text-sm font-medium\">Uploaded</h4>\n            <div className=\"grid grid-cols-2 gap-2 md:grid-cols-3 lg:grid-cols-4\">\n              {files\n                .filter((f) => f.status === \"success\" && f.url)\n                .map((file) => (\n                  <div\n                    key={file.id}\n                    className=\"group relative aspect-square overflow-hidden rounded-lg border border-border bg-muted\"\n                  >\n                    {file.type?.startsWith(\"image/\") && file.url && (\n                      <img\n                        src={file.url}\n                        alt={file.name}\n                        className=\"h-full w-full object-cover\"\n                      />\n                    )}\n                    <div className=\"absolute inset-0 bg-black/0 transition-colors group-hover:bg-black/20\" />\n                    <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2\">\n                      <p className=\"truncate text-xs font-medium text-white\">\n                        {file.name}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Error display */}\n      {allErrors.length > 0 && (\n        <div className=\"space-y-2\">\n          {allErrors.map((error, index) => (\n            <div\n              key={index}\n              className=\"flex items-center space-x-2 text-sm text-destructive\"\n            >\n              <AlertCircle className=\"h-4 w-4\" />\n              <span>{error}</span>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) return \"0 Bytes\";\n  const k = 1024;\n  const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n}\n\n",
      "type": "registry:component"
    }
  ]
}