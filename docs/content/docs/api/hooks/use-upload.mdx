---
title: useUpload
description: React hook for managing file uploads with full type safety and reactive state
---

import { Callout } from "fumadocs-ui/components/callout";
import { Card, Cards } from "fumadocs-ui/components/card";
import { Tab, Tabs } from "fumadocs-ui/components/tabs";
import { Steps, Step } from "fumadocs-ui/components/steps";
import { TypeTable } from "fumadocs-ui/components/type-table";

# useUpload

The `useUpload` hook provides a React-friendly API for managing file uploads with reactive state management, progress tracking, and error handling.

<Callout type="info">
  This hook is perfect for teams that prefer the familiar React hooks pattern.
  For enhanced type safety with property-based access, see the [Client
  Configuration](/docs/api/configuration/client-options) guide.
</Callout>

## Basic Usage

```typescript
import { useUpload } from "pushduck/client";
import type { AppRouter } from "@/lib/upload";

export function ImageUploader() {
  const { uploadFiles, files, isUploading, error, reset } =
    useUpload<AppRouter>("imageUpload");

  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    const selectedFiles = Array.from(e.target.files || []);
    uploadFiles(selectedFiles);
  };

  return (
    <div>
      <input
        type="file"
        multiple
        accept="image/*"
        onChange={handleFileSelect}
      />

      {files.map((file) => (
        <div key={file.id}>
          <span>{file.name}</span>
          <progress value={file.progress} max={100} />
          {file.status === "success" && <a href={file.url}>View</a>}
          {file.status === "error" && <span>Error: {file.error}</span>}
        </div>
      ))}

      <button onClick={reset} disabled={isUploading}>
        Reset
      </button>
    </div>
  );
}
```

## Hook API Reference

<TypeTable
  type={{
    uploadFiles: {
      description: "Function to upload selected files",
      type: "(files: File[], options?: UploadOptions) => Promise<UploadResult[]>",
    },
    files: {
      description: "Array of files with upload status and progress",
      type: "UploadFile[]",
    },
    isUploading: {
      description: "Boolean indicating if any upload is in progress",
      type: "boolean",
    },
    uploadedFiles: {
      description: "Array of successfully uploaded files",
      type: "UploadResult[]",
    },
    error: {
      description: "Upload error if any occurred",
      type: "UploadError | null",
    },
    progress: {
      description: "Overall upload progress (0-100)",
      type: "number",
    },
    reset: {
      description: "Function to reset upload state",
      type: "() => void",
    },
    cancel: {
      description: "Function to cancel ongoing uploads",
      type: "() => void",
    },
  }}
/>

## Hook Options

<TypeTable
  type={{
    onStart: {
      description: "Callback when upload process begins (after validation)",
      type: "(files: S3FileMetadata[]) => void",
    },
    onSuccess: {
      description: "Callback when all uploads complete successfully",
      type: "(results: UploadResult[]) => void",
    },
    onError: {
      description: "Callback when upload fails",
      type: "(error: UploadError) => void",
    },
    onProgress: {
      description: "Callback for upload progress updates",
      type: "(progress: number) => void",
    },
    disabled: {
      description: "Disable upload functionality",
      type: "boolean",
      default: "false",
    },
    autoUpload: {
      description: "Automatically upload files when selected",
      type: "boolean",
      default: "true",
    },
    maxFiles: {
      description: "Maximum number of files allowed",
      type: "number",
    },
  }}
/>

## Advanced Usage Examples

### Upload with Callbacks

```typescript
export function AdvancedUploader() {
  const { uploadFiles, files, isUploading } = useUpload<AppRouter>(
    "documentUpload",
    {
      onStart: (files) => {
        toast.info(`Starting upload of ${files.length} files...`);
        setUploadStarted(true);
      },

      onSuccess: (results) => {
        toast.success(`Successfully uploaded ${results.length} files`);
        // Update your app state
        updateDocuments(results);
        setUploadStarted(false);
      },

      onError: (error) => {
        toast.error(`Upload failed: ${error.message}`);
        // Log error for debugging
        console.error("Upload error:", error);
        setUploadStarted(false);
      },

      onProgress: (progress) => {
        // Update global progress indicator
        setGlobalProgress(progress);
      },

      maxFiles: 5,
    }
  );

  const handleUpload = async (selectedFiles: File[]) => {
    try {
      await uploadFiles(selectedFiles, {
        metadata: {
          category: "user-documents",
          timestamp: Date.now(),
        },
      });
    } catch (error) {
      // Handle specific upload errors
      if (error.code === "FILE_TOO_LARGE") {
        toast.error("One or more files are too large");
      }
    }
  };

  return <div>{/* Upload UI */}</div>;
}
```

### Multiple Upload Types

```typescript
export function MultiTypeUploader() {
  const images = useUpload<AppRouter>("imageUpload", {
    maxFiles: 10,
    onSuccess: (results) => setImages((prev) => [...prev, ...results]),
  });

  const documents = useUpload<AppRouter>("documentUpload", {
    maxFiles: 5,
    onSuccess: (results) => setDocuments((prev) => [...prev, ...results]),
  });

  const videos = useUpload<AppRouter>("videoUpload", {
    maxFiles: 2,
    onSuccess: (results) => setVideos((prev) => [...prev, ...results]),
  });

  return (
    <div className="upload-tabs">
      <Tabs items={["Images", "Documents", "Videos"]}>
        <Tab value="Images">
          <UploadZone
            onFilesDrop={(files) => images.uploadFiles(files)}
            accept="image/*"
            multiple
            disabled={images.isUploading}
          />
          <FileList files={images.files} />
        </Tab>

        <Tab value="Documents">
          <UploadZone
            onFilesDrop={(files) => documents.uploadFiles(files)}
            accept=".pdf,.doc,.docx"
            multiple
            disabled={documents.isUploading}
          />
          <FileList files={documents.files} />
        </Tab>

        <Tab value="Videos">
          <UploadZone
            onFilesDrop={(files) => videos.uploadFiles(files)}
            accept="video/*"
            disabled={videos.isUploading}
          />
          <FileList files={videos.files} />
        </Tab>
      </Tabs>
    </div>
  );
}
```

### Custom Upload Hook

Create reusable upload hooks for specific use cases:

```typescript
import { useUpload } from "pushduck/client";
import { useCallback } from "react";
import { toast } from "sonner";

export function useProfilePictureUpload() {
  const upload = useUpload<AppRouter>("profilePicture", {
    maxFiles: 1,
    onSuccess: (results) => {
      toast.success("Profile picture updated!");
      // Update user profile
      updateProfile({ avatar: results[0].url });
    },
    onError: (error) => {
      toast.error("Failed to update profile picture");
    },
  });

  const uploadProfilePicture = useCallback(
    async (file: File) => {
      // Validate file before upload
      if (file.size > 2 * 1024 * 1024) {
        // 2MB
        toast.error("Profile picture must be less than 2MB");
        return;
      }

      if (!file.type.startsWith("image/")) {
        toast.error("Please select an image file");
        return;
      }

      await upload.uploadFiles([file], {
        metadata: {
          type: "profile-picture",
          userId: getCurrentUserId(),
        },
      });
    },
    [upload.uploadFiles]
  );

  return {
    ...upload,
    uploadProfilePicture,
  };
}

// Usage
export function ProfilePictureUploader() {
  const { uploadProfilePicture, files, isUploading } =
    useProfilePictureUpload();

  return (
    <div>
      <input
        type="file"
        accept="image/*"
        onChange={(e) => {
          const file = e.target.files?.[0];
          if (file) uploadProfilePicture(file);
        }}
        disabled={isUploading}
      />
      {/* Show upload progress */}
    </div>
  );
}
```

## File State Management

### UploadFile Type

<TypeTable
  type={{
    id: {
      description: "Unique identifier for the file",
      type: "string",
    },
    name: {
      description: "Original filename",
      type: "string",
    },
    size: {
      description: "File size in bytes",
      type: "number",
    },
    type: {
      description: "MIME type of the file",
      type: "string",
    },
    status: {
      description: "Current upload status",
      type: "'pending' | 'uploading' | 'success' | 'error'",
    },
    progress: {
      description: "Upload progress percentage (0-100)",
      type: "number",
    },
    url: {
      description: "File URL after successful upload",
      type: "string | null",
    },
    key: {
      description: "S3 key for the uploaded file",
      type: "string | null",
    },
    error: {
      description: "Error message if upload failed",
      type: "string | null",
    },
  }}
/>

### File Status Transitions

```typescript
export function FileStatusIndicator({ file }: { file: UploadFile }) {
  const getStatusIcon = () => {
    switch (file.status) {
      case "pending":
        return <ClockIcon className="text-gray-400" />;
      case "uploading":
        return <SpinnerIcon className="text-blue-500 animate-spin" />;
      case "success":
        return <CheckIcon className="text-green-500" />;
      case "error":
        return <XIcon className="text-red-500" />;
    }
  };

  const getStatusText = () => {
    switch (file.status) {
      case "pending":
        return "Waiting to upload...";
      case "uploading":
        return `Uploading... ${file.progress}%`;
      case "success":
        return "Upload complete";
      case "error":
        return `Error: ${file.error}`;
    }
  };

  return (
    <div className="flex items-center gap-2">
      {getStatusIcon()}
      <span className="text-sm">{getStatusText()}</span>
    </div>
  );
}
```

## Error Handling

### Error Types

<TypeTable
  type={{
    code: {
      description: "Error code for programmatic handling",
      type: "'FILE_TOO_LARGE' | 'INVALID_TYPE' | 'NETWORK_ERROR' | 'SERVER_ERROR' | 'QUOTA_EXCEEDED'",
    },
    message: {
      description: "Human-readable error message",
      type: "string",
    },
    status: {
      description: "HTTP status code if applicable",
      type: "number | null",
    },
    metadata: {
      description: "Additional error context",
      type: "Record<string, any>",
    },
  }}
/>

### Error Handling Patterns

```typescript
export function ErrorHandlingUploader() {
  const { uploadFiles, files, error } = useUpload<AppRouter>("fileUpload", {
    onError: (error) => {
      switch (error.code) {
        case "FILE_TOO_LARGE":
          toast.error("File is too large. Please choose a smaller file.");
          break;
        case "INVALID_TYPE":
          toast.error(
            "File type not supported. Please choose a different file."
          );
          break;
        case "QUOTA_EXCEEDED":
          toast.error("Upload quota exceeded. Please upgrade your plan.");
          break;
        case "NETWORK_ERROR":
          toast.error(
            "Network error. Please check your connection and try again."
          );
          break;
        default:
          toast.error("Upload failed. Please try again.");
      }
    },
  });

  const handleRetry = () => {
    const failedFiles = files.filter((file) => file.status === "error");
    if (failedFiles.length > 0) {
      // Convert UploadFile back to File for retry
      const filesToRetry = failedFiles
        .map((f) => f.originalFile)
        .filter(Boolean);
      uploadFiles(filesToRetry);
    }
  };

  return (
    <div>
      {/* Upload UI */}

      {error && (
        <div className="error-banner">
          <span>{error.message}</span>
          <button onClick={handleRetry}>Retry</button>
        </div>
      )}
    </div>
  );
}
```

## Integration Examples

### Form Integration

```typescript
import { useForm } from "react-hook-form";
import { useUpload } from "pushduck/client";

interface FormData {
  title: string;
  description: string;
  files: UploadResult[];
}

export function DocumentForm() {
  const { register, handleSubmit, setValue, watch } = useForm<FormData>();

  const { uploadFiles, uploadedFiles, isUploading } = useUpload<AppRouter>(
    "documentUpload",
    {
      onSuccess: (results) => {
        // Update form data with uploaded files
        setValue("files", results);
      },
    }
  );

  const onSubmit = (data: FormData) => {
    console.log("Form submitted:", data);
    // Submit form with uploaded file URLs
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <input {...register("title")} placeholder="Document title" />
      <textarea {...register("description")} placeholder="Description" />

      <input
        type="file"
        multiple
        onChange={(e) => uploadFiles(Array.from(e.target.files || []))}
      />

      <button type="submit" disabled={isUploading}>
        {isUploading ? "Uploading..." : "Submit"}
      </button>
    </form>
  );
}
```

### Drag and Drop Integration

```typescript
import { useDropzone } from "react-dropzone";
import { useUpload } from "pushduck/client";

export function DragDropUploader() {
  const { uploadFiles, files, isUploading } =
    useUpload<AppRouter>("imageUpload");

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    onDrop: (acceptedFiles) => {
      uploadFiles(acceptedFiles);
    },
    accept: {
      "image/*": [".png", ".jpg", ".jpeg", ".gif", ".webp"],
    },
    maxFiles: 10,
  });

  return (
    <div
      {...getRootProps()}
      className={`dropzone ${isDragActive ? "active" : ""}`}
    >
      <input {...getInputProps()} />

      {isDragActive ? (
        <p>Drop the files here...</p>
      ) : (
        <p>Drag & drop images here, or click to select files</p>
      )}

      {files.length > 0 && (
        <div className="file-list">
          {files.map((file) => (
            <div key={file.id} className="file-item">
              <span>{file.name}</span>
              <progress value={file.progress} max={100} />
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
```

---

<Callout type="success">
  **Next Steps:** Explore [utility
  functions](/docs/api/utilities/create-upload-client) for advanced upload
  client customization, or check out [complete examples](/docs/examples) to see
  the hook in action.
</Callout>
