---
title: Image Upload Guide
description: Upload images with validation, optimization, and beautiful UI components
---

# Image Upload Guide

Build robust image upload functionality with validation, previews, and optimization.

## üñºÔ∏è Basic Image Upload

Start with a simple image upload component:

```typescript
// components/ImageUpload.tsx
import { upload } from "@/lib/upload-client";

export function ImageUpload() {
  const { uploadFiles, files, isUploading } = upload.imageUpload();

  return (
    <div className="space-y-4">
      <div>
        <label className="block text-sm font-medium mb-2">Upload Images</label>
        <input
          type="file"
          accept="image/*"
          multiple
          onChange={(e) => uploadFiles(e.target.files)}
          className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
        />
      </div>

      {files.length > 0 && (
        <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
          {files.map((file) => (
            <div key={file.id} className="relative">
              {file.url ? (
                <img
                  src={file.url}
                  alt={file.name}
                  className="w-full h-32 object-cover rounded-lg"
                />
              ) : (
                <div className="w-full h-32 bg-gray-100 rounded-lg flex items-center justify-center">
                  <div className="text-center">
                    <div className="text-sm text-gray-500">{file.name}</div>
                    <div className="text-xs text-gray-400">
                      {file.status === "uploading" && `${file.progress}%`}
                    </div>
                  </div>
                </div>
              )}

              {file.status === "uploading" && (
                <div className="absolute bottom-2 left-2 right-2">
                  <div className="w-full bg-gray-200 rounded-full h-1">
                    <div
                      className="bg-blue-600 h-1 rounded-full transition-all"
                      style={{ width: `${file.progress}%` }}
                    />
                  </div>
                </div>
              )}
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
```

## üîß Server Configuration

Configure your image upload route with validation:

```typescript
// app/api/s3-upload/route.ts
import { createS3Router, s3 } from "next-s3-uploader/server";

const s3Router = createS3Router({
  imageUpload: s3
    .image()
    .max("5MB") // File size limit
    .formats(["jpeg", "jpg", "png", "webp"]) // Allowed formats
    .dimensions({
      // Image dimensions
      min: { width: 100, height: 100 },
      max: { width: 4000, height: 4000 },
    }),
});

export type AppS3Router = typeof s3Router;
export const { GET, POST } = createS3Handler(s3Router);
```

## üé® Drag & Drop Upload

Create a beautiful drag & drop interface:

```typescript
// components/ImageDropZone.tsx
import { upload } from "@/lib/upload-client";
import { useState } from "react";

export function ImageDropZone() {
  const { uploadFiles, files, isUploading } = upload.imageUpload();
  const [isDragOver, setIsDragOver] = useState(false);

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragOver(false);

    const droppedFiles = Array.from(e.dataTransfer.files).filter((file) =>
      file.type.startsWith("image/")
    );

    if (droppedFiles.length > 0) {
      uploadFiles(droppedFiles);
    }
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragOver(true);
  };

  const handleDragLeave = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragOver(false);
  };

  return (
    <div className="space-y-6">
      <div
        onDrop={handleDrop}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        className={`
          border-2 border-dashed rounded-lg p-8 text-center transition-colors
          ${
            isDragOver
              ? "border-blue-400 bg-blue-50"
              : "border-gray-300 hover:border-gray-400"
          }
        `}
      >
        <div className="space-y-4">
          <div className="text-4xl">üñºÔ∏è</div>
          <div>
            <p className="text-lg font-medium">
              Drop images here or click to browse
            </p>
            <p className="text-sm text-gray-500">
              PNG, JPG, WebP up to 5MB each
            </p>
          </div>

          <input
            type="file"
            accept="image/*"
            multiple
            onChange={(e) => uploadFiles(e.target.files)}
            className="hidden"
            id="image-input"
          />
          <label
            htmlFor="image-input"
            className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 cursor-pointer"
          >
            Choose Images
          </label>
        </div>
      </div>

      {files.length > 0 && (
        <div>
          <h3 className="font-medium mb-4">Uploaded Images ({files.length})</h3>
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {files.map((file) => (
              <ImagePreview key={file.id} file={file} />
            ))}
          </div>
        </div>
      )}
    </div>
  );
}

function ImagePreview({ file }: { file: UploadedFile }) {
  return (
    <div className="relative bg-white rounded-lg shadow border overflow-hidden">
      {file.url ? (
        <img
          src={file.url}
          alt={file.name}
          className="w-full h-48 object-cover"
        />
      ) : (
        <div className="w-full h-48 bg-gray-100 flex items-center justify-center">
          <div className="text-center">
            <div className="text-sm text-gray-500 mb-2">{file.name}</div>
            <div className="w-16 bg-gray-200 rounded-full h-2 mx-auto">
              <div
                className="bg-blue-600 h-2 rounded-full transition-all"
                style={{ width: `${file.progress}%` }}
              />
            </div>
          </div>
        </div>
      )}

      <div className="p-3">
        <div className="flex items-center justify-between">
          <div className="text-sm font-medium truncate">{file.name}</div>
          <div className="text-xs text-gray-500 ml-2">
            {file.status === "completed" && "‚úÖ"}
            {file.status === "uploading" && "‚è≥"}
            {file.status === "error" && "‚ùå"}
          </div>
        </div>

        {file.status === "error" && (
          <div className="text-xs text-red-600 mt-1">
            Upload failed - try again
          </div>
        )}
      </div>
    </div>
  );
}
```

## ‚úÖ Advanced Validation

Add comprehensive image validation:

```typescript
// app/api/s3-upload/route.ts
const s3Router = createS3Router({
  profileImage: s3
    .image()
    .max("2MB")
    .formats(["jpeg", "jpg", "png", "webp"])
    .dimensions({
      min: { width: 200, height: 200 },
      max: { width: 2000, height: 2000 },
      aspectRatio: { min: 0.8, max: 1.2 }, // Nearly square
    })
    .middleware(async ({ file, req }) => {
      // Custom validation
      if (file.name.includes("test")) {
        throw new Error("Test images not allowed");
      }

      // User-specific validation
      const user = await getCurrentUser(req);
      if (!user.isPremium && file.size > 1024 * 1024) {
        // 1MB
        throw new Error("Premium required for large images");
      }

      return { userId: user.id };
    }),

  galleryImages: s3
    .image()
    .max("10MB")
    .formats(["jpeg", "jpg", "png", "webp", "avif"])
    .array()
    .min(1)
    .max(10) // Max 10 images at once
    .middleware(async ({ files, req }) => {
      const user = await getCurrentUser(req);

      // Check total storage limit
      const currentUsage = await getUserStorageUsage(user.id);
      const uploadSize = files.reduce((sum, file) => sum + file.size, 0);

      if (currentUsage + uploadSize > user.storageLimit) {
        throw new Error("Storage limit exceeded");
      }

      return { userId: user.id };
    }),
});
```

## üì± Responsive Image Upload

Create a mobile-friendly upload component:

```typescript
// components/ResponsiveImageUpload.tsx
import { upload } from "@/lib/upload-client";
import { useState } from "react";

export function ResponsiveImageUpload() {
  const { uploadFiles, files, isUploading } = upload.galleryImages();
  const [viewMode, setViewMode] = useState<"grid" | "list">("grid");

  return (
    <div className="space-y-4">
      {/* Upload Area */}
      <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 sm:p-6">
        <div className="text-center">
          <div className="text-2xl sm:text-4xl mb-2">üì∏</div>
          <p className="text-sm sm:text-base font-medium">
            Add images to your gallery
          </p>
          <p className="text-xs sm:text-sm text-gray-500 mb-4">
            Up to 10 images, 10MB each
          </p>

          <input
            type="file"
            accept="image/*"
            multiple
            onChange={(e) => uploadFiles(e.target.files)}
            className="hidden"
            id="gallery-input"
          />
          <label
            htmlFor="gallery-input"
            className="inline-flex items-center px-3 py-2 sm:px-4 sm:py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 cursor-pointer"
          >
            Choose Images
          </label>
        </div>
      </div>

      {/* View Controls */}
      {files.length > 0 && (
        <div className="flex items-center justify-between">
          <h3 className="font-medium">Images ({files.length})</h3>
          <div className="flex space-x-2">
            <button
              onClick={() => setViewMode("grid")}
              className={`p-2 rounded ${
                viewMode === "grid"
                  ? "bg-blue-100 text-blue-600"
                  : "text-gray-400"
              }`}
            >
              <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
              </svg>
            </button>
            <button
              onClick={() => setViewMode("list")}
              className={`p-2 rounded ${
                viewMode === "list"
                  ? "bg-blue-100 text-blue-600"
                  : "text-gray-400"
              }`}
            >
              <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 8a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 12a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 16a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" />
              </svg>
            </button>
          </div>
        </div>
      )}

      {/* Image Display */}
      {viewMode === "grid" ? (
        <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-4">
          {files.map((file) => (
            <GridImageCard key={file.id} file={file} />
          ))}
        </div>
      ) : (
        <div className="space-y-2">
          {files.map((file) => (
            <ListImageCard key={file.id} file={file} />
          ))}
        </div>
      )}
    </div>
  );
}

function GridImageCard({ file }: { file: UploadedFile }) {
  return (
    <div className="relative aspect-square bg-gray-100 rounded-lg overflow-hidden">
      {file.url ? (
        <img
          src={file.url}
          alt={file.name}
          className="w-full h-full object-cover"
        />
      ) : (
        <div className="w-full h-full flex items-center justify-center">
          <div className="text-center p-2">
            <div className="text-xs text-gray-500 mb-1 truncate">
              {file.name}
            </div>
            <div className="w-12 bg-gray-200 rounded-full h-1">
              <div
                className="bg-blue-600 h-1 rounded-full transition-all"
                style={{ width: `${file.progress}%` }}
              />
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

function ListImageCard({ file }: { file: UploadedFile }) {
  return (
    <div className="flex items-center space-x-3 p-3 bg-white rounded-lg border">
      <div className="w-12 h-12 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0">
        {file.url ? (
          <img
            src={file.url}
            alt={file.name}
            className="w-full h-full object-cover"
          />
        ) : (
          <div className="w-full h-full flex items-center justify-center">
            <div className="text-gray-400">üìÑ</div>
          </div>
        )}
      </div>

      <div className="flex-1 min-w-0">
        <div className="text-sm font-medium text-gray-900 truncate">
          {file.name}
        </div>
        <div className="text-xs text-gray-500">
          {file.status === "completed" &&
            `Uploaded ‚Ä¢ ${formatFileSize(file.size)}`}
          {file.status === "uploading" && `Uploading ${file.progress}%`}
          {file.status === "error" && "Upload failed"}
        </div>

        {file.status === "uploading" && (
          <div className="w-full bg-gray-200 rounded-full h-1 mt-1">
            <div
              className="bg-blue-600 h-1 rounded-full transition-all"
              style={{ width: `${file.progress}%` }}
            />
          </div>
        )}
      </div>

      <div className="flex-shrink-0">
        {file.status === "completed" && (
          <span className="text-green-500">‚úÖ</span>
        )}
        {file.status === "uploading" && (
          <span className="text-blue-500">‚è≥</span>
        )}
        {file.status === "error" && <span className="text-red-500">‚ùå</span>}
      </div>
    </div>
  );
}

function formatFileSize(bytes: number): string {
  if (bytes === 0) return "0 Bytes";
  const k = 1024;
  const sizes = ["Bytes", "KB", "MB", "GB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
}
```

## üîß Image Optimization

Add automatic image optimization on upload:

```typescript
// app/api/s3-upload/route.ts
import { createS3Router, s3 } from "next-s3-uploader/server";
import sharp from "sharp"; // npm install sharp

const s3Router = createS3Router({
  optimizedImages: s3
    .image()
    .max("20MB") // Accept larger files for processing
    .formats(["jpeg", "jpg", "png", "webp"])
    .onUploadComplete(async ({ file, key, metadata }) => {
      // Generate optimized versions
      const originalBuffer = await downloadFile(key);

      // Create thumbnail (200x200)
      const thumbnail = await sharp(originalBuffer)
        .resize(200, 200, { fit: "cover" })
        .jpeg({ quality: 80 })
        .toBuffer();

      // Create medium size (800px wide)
      const medium = await sharp(originalBuffer)
        .resize(800, null, { withoutEnlargement: true })
        .jpeg({ quality: 85 })
        .toBuffer();

      // Create WebP version
      const webp = await sharp(originalBuffer).webp({ quality: 80 }).toBuffer();

      // Upload optimized versions
      await Promise.all([
        uploadFile(`${key}-thumbnail.jpg`, thumbnail),
        uploadFile(`${key}-medium.jpg`, medium),
        uploadFile(`${key}.webp`, webp),
      ]);

      return {
        ...file,
        variants: {
          thumbnail: `${file.url}-thumbnail.jpg`,
          medium: `${file.url}-medium.jpg`,
          webp: `${file.url}.webp`,
        },
      };
    }),
});
```

## üìä Upload Analytics

Track image upload metrics:

```typescript
// app/api/s3-upload/route.ts
const s3Router = createS3Router({
  analyticsImages: s3
    .image()
    .max("5MB")
    .onUploadStart(async ({ file, metadata }) => {
      // Track upload start
      await analytics.track("image_upload_started", {
        fileSize: file.size,
        fileType: file.type,
        userId: metadata.userId,
      });
    })
    .onUploadProgress(async ({ file, progress, metadata }) => {
      // Track progress milestones
      if (progress === 50 || progress === 100) {
        await analytics.track("image_upload_progress", {
          fileName: file.name,
          progress,
          userId: metadata.userId,
        });
      }
    })
    .onUploadComplete(async ({ file, metadata, uploadTime }) => {
      // Track successful upload
      await analytics.track("image_upload_completed", {
        fileSize: file.size,
        uploadDuration: uploadTime,
        userId: metadata.userId,
        success: true,
      });

      // Update user storage usage
      await updateUserStorageUsage(metadata.userId, file.size);
    })
    .onUploadError(async ({ file, error, metadata }) => {
      // Track upload failures
      await analytics.track("image_upload_failed", {
        fileName: file.name,
        errorMessage: error.message,
        userId: metadata.userId,
        success: false,
      });
    }),
});
```

## üéØ Common Use Cases

### Profile Avatar Upload

```typescript
// components/AvatarUpload.tsx
export function AvatarUpload({ currentAvatar }: { currentAvatar?: string }) {
  const { uploadFiles, files } = upload.profileImage();

  const latestFile = files[files.length - 1];
  const displayUrl = latestFile?.url || currentAvatar;

  return (
    <div className="flex items-center space-x-4">
      <div className="w-20 h-20 rounded-full overflow-hidden bg-gray-100 border-2 border-gray-300">
        {displayUrl ? (
          <img
            src={displayUrl}
            alt="Profile"
            className="w-full h-full object-cover"
          />
        ) : (
          <div className="w-full h-full flex items-center justify-center">
            <span className="text-gray-400">üë§</span>
          </div>
        )}
      </div>

      <div>
        <input
          type="file"
          accept="image/*"
          onChange={(e) => uploadFiles(e.target.files)}
          className="hidden"
          id="avatar-input"
        />
        <label
          htmlFor="avatar-input"
          className="cursor-pointer text-sm font-medium text-blue-600 hover:text-blue-500"
        >
          Change Avatar
        </label>
        <p className="text-xs text-gray-500">JPG, PNG up to 2MB</p>
      </div>
    </div>
  );
}
```

### Image Gallery with Lightbox

```typescript
// components/ImageGallery.tsx
import { useState } from "react";

export function ImageGallery() {
  const { uploadFiles, files } = upload.galleryImages();
  const [lightboxImage, setLightboxImage] = useState<string | null>(null);

  return (
    <div className="space-y-6">
      {/* Upload Area */}
      <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
        <input
          type="file"
          accept="image/*"
          multiple
          onChange={(e) => uploadFiles(e.target.files)}
          className="hidden"
          id="gallery-input"
        />
        <label
          htmlFor="gallery-input"
          className="cursor-pointer inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"
        >
          Add Images to Gallery
        </label>
      </div>

      {/* Gallery Grid */}
      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {files
          .filter((f) => f.url)
          .map((file) => (
            <button
              key={file.id}
              onClick={() => setLightboxImage(file.url!)}
              className="aspect-square bg-gray-100 rounded-lg overflow-hidden hover:opacity-90 transition-opacity"
            >
              <img
                src={file.url}
                alt={file.name}
                className="w-full h-full object-cover"
              />
            </button>
          ))}
      </div>

      {/* Lightbox */}
      {lightboxImage && (
        <div
          className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"
          onClick={() => setLightboxImage(null)}
        >
          <img
            src={lightboxImage}
            alt="Full size"
            className="max-w-full max-h-full object-contain"
          />
        </div>
      )}
    </div>
  );
}
```

## üìö Next Steps

- **[Document Upload Guide](/guides/uploads/documents)** - Handle PDFs and documents
- **[Multiple Files](/guides/uploads/multiple-files)** - Batch upload patterns
- **[Drag & Drop](/guides/uploads/drag-and-drop)** - Advanced drag & drop features
- **[API Reference](/api-reference)** - Complete API documentation

---

**Need help?** Check our [Examples](/examples) or [Troubleshooting Guide](/guides/going-live/troubleshooting)
